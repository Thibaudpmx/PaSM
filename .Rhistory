geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7)
param
param %>% filter(!!parse_expr(pointsabove))
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T))
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T)) %>%
filter(is.na(nop))
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
left_join( param %>% filter(!!parse_expr(pointsbelow)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
filter(!( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44))
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
left_join( param %>% filter(!!parse_expr(pointsbelow)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
filter(!( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44)) %>%
sample_n(20)
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
left_join( param %>% filter(!!parse_expr(pointsbelow)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
filter(!( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44)) %>%
sample_n(20) -> news
theme_bw()
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
geom_point(data = news, aes(k2, lambda0))+
theme_bw()
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7)
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot8 <- plot7 +
geom_point(data = news, aes(k2, lambda0))
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8)
self$plot_2D(k2, lambda0, plotMain = T)
self$plot_2D(k2, lambda0, plotMain = T, plotoreturn = 1)
self$n_filter_reduc()
self$plot_2D(k2, lambda0, plotMain = T, plotoreturn = 2)
self$plot_2D(k2, lambda0, plotMain = T, plotoreturn = 3)
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2)
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot7
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2)
param %>% filter(!!parse_expr(pointsabove)) %>% left_join(param20)
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) %>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")) ,
aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow))%>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")),
aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) %>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")) ,
aes(k2, lambda0,  col = "Above", shape = shape))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow))%>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")),
aes(k2, lambda0,  col = "Below", shape = shape))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot7
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) %>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")) ,
aes(k2, lambda0,  col = "Above", shape = shape))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow))%>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")),
aes(k2, lambda0,  col = "Below", shape = shape))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) %>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")) ,
aes(k2, lambda0,  col = "Above", shape = shape))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow))%>% left_join(param20) %>% mutate(shape = if_else(is.na(id), "Extrapolated", "RxODE")),
aes(k2, lambda0,  col = "Below", shape = shape))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw();plot7
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
theme_bw()
plot7
plot7
plot7 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
theme_bw()
plot7
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
theme_bw()
plot7
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
theme_bw() ; plot7
theme_bw() ; plot7
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
labs(col = "")+
theme_bw() ; plot7
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) , aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()+
geom_point(data = news, aes(k2, lambda0))
news
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) , aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()+
geom_point(data = news, aes(k2, lambda0))
plot8 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) , aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
theme_bw()+
geom_point(data = news, aes(k2, lambda0))
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2)
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
plot8 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) , aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
labs(col = "VPs")+
theme_bw()+
geom_point(data = news, aes(k2, lambda0))
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
plot3 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = forsquare %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "green", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot3
plot3 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = forsquare %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "chartreuse4", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot3
plot3 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = forsquare %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot3
plot4 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot4
plot5 <-
param20 %>%
ggplot()+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2)+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot5
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
labs(col = "Extrapolated VPs")+
theme_bw() ; plot7
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
labs(col = "VPs")+
theme_bw() ; plot7
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
labs(col = "   VPs")+
theme_bw() ; plot7
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
plot4 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot4
filtersreduc
filter_reduc(forsquare %>% filter(label == "Above"), filtre = self$make_filters()[1]) %>%
bind_rows(
filter_reduc(forsquare %>% filter(label == "Below"), filtre = self$make_filters()[2])
) ->filtersreduc
plot4 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot4
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
param %>% filter(!!parse_expr(pointsabove))
param %>% filter(!!parse_expr(pointsbelow))
276+275
param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44)
551 + 6 + 20
plot6 <- plot5 +
geom_rect(data = forsquaregreen %>% slice(-5, -8), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0.2)+
geom_rect(data = forsquaregreen %>% slice(10), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0, col = "darkgreen",  lty= 3)+
geom_rect(data = forsquaregreen %>% slice(3), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0, col = "darkgreen",  lty= 2)+
# forsquaregreen %>% slice(-5, -8)+
scale_fill_manual(values = c("red", "chocolate", "darkgreen"))+
# geom_rect(aes(xmin = 3.6, xmax = 3.8, ymin = 0.4, ymax = 0.44, fill = "Green"); )+
geom_segment(aes(x = 3.6, xend = 3.6, y= 0.44, yend = 0.4 ), col = "darkgreen")+
geom_segment(aes(x = 3.8 , xend = 3.8 , y= 0.44, yend = 0.4 ), col = "darkgreen")+
geom_segment(aes(x = 3.6, xend = 3.8 , y= 0.44, yend = 0.44 ), col = "darkgreen")+
geom_segment(aes(x = 3.6, xend = 3.8, y= 0.4, yend = 0.4 ), col = "darkgreen")+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0), col = "darkgreen", alpha = 0.2); plot6
plot1 <-  param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0))+
theme_bw(); plot1
ids <-   param20 %>%
rowid_to_column("id")
events <- self$protocols$dose50 %>% mutate(evid = 1) %>%
bind_rows(tibble(time = self$times, evid = 0, amt = 0, cmt = "Conc")) %>%
crossing(id = 1:20) %>%
arrange(id, time)
simulations <- self$model$solve(ids, events, c(X1 = 50)) %>% as_tibble()
analysis <- simulations %>%
filter(time %in% self$targets$time) %>%
mutate(cmt = "tumVol") %>%
left_join( self$targets) %>%
mutate(below = tumVol > min, above = tumVol < max) %>%
mutate(type = case_when(below & above ~ "Accepted",
below & !above ~ "Above",
!below & above ~ "Below"))
analysis <- analysis %>% distinct(id, type) %>%
group_by(id) %>%
nest() %>%
mutate(label = map_chr(data, function(x){
if(nrow(x) == 2 & "Accepted" %in% x$type ) x <- x %>% filter(x != "Accepted")
paste0(x$type, collapse = "&")
} ))
plot2 <- simulations %>%
left_join(analysis %>%  select(id, label)) %>%
ggplot()+
geom_line(aes(time, tumVol, group = id))+
geom_segment(data = self$targets, aes(x = time, xend = time, y = min, yend = max), col = "red", size = 2)+
scale_y_log10()+
facet_wrap(~label) +
labs(x = "Time (days)", y = "Tumor volume (mm3)")+
theme_bw(); plot2
param20 <- param20 %>%
rowid_to_column("id") %>%
left_join(analysis %>%  select(id, label))
forsquare <- param20 %>%
# filter(label) %>%
mutate(k2min = if_else(label == "Above", 0, k2),
k2max = if_else(label == "Above", k2, Inf),
lambda0min = if_else(label == "Below", 0, lambda0),
lambda0max = if_else(label == "Below", lambda0, Inf))
plot3 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = forsquare %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot3
filter_reduc(forsquare %>% filter(label == "Above"), filtre = self$make_filters()[1]) %>%
bind_rows(
filter_reduc(forsquare %>% filter(label == "Below"), filtre = self$make_filters()[2])
) ->filtersreduc
plot4 <-
param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2, col = "black")+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot4
filtersreduc %>%
filter(k2max < Inf) %>%
mutate(filter = paste0("k2 <=", k2, " & lambda0 >= ", lambda0 )) %>%
pull(filter) -> pointsabove
pointsabove <- paste0("(", pointsabove, ")") %>% paste0(collapse = "|")
filtersreduc %>%
filter(k2max == Inf) %>%
mutate(filter = paste0("k2 >=", k2, " & lambda0 <= ", lambda0 )) %>%
pull(filter)  -> pointsbelow
pointsbelow <- paste0("(", pointsbelow, ")") %>% paste0(collapse = "|")
plot5 <-
param20 %>%
ggplot()+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_rect(data = filtersreduc %>% filter(label != "Accepted"),
aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = label ),
alpha = 0.2)+
theme_bw()+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
scale_fill_manual(values = c("red", "chocolate"))+
labs(col = "VPs", fill = "Filters"); plot5
forsquaregreen <-
param20 %>%
filter(label == "Accepted") %>%
mutate(label = "Above") %>%
bind_rows(
param20 %>%
filter(label == "Accepted") %>%
mutate(label = "Below")
) %>%
# filter(label) %>%
mutate(k2min = if_else(label == "Above", 0, k2),
k2max = if_else(label == "Above", k2, Inf),
lambda0min = if_else(label == "Below", 0, lambda0),
lambda0max = if_else(label == "Below", lambda0, Inf)) %>%
mutate(label2 = if_else(label == "Above", "Above\nLower Limit", "Below\nUpper Limit"))
forsquaregreen
plot6 <- plot5 +
geom_rect(data = forsquaregreen %>% slice(-5, -8), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0.2)+
geom_rect(data = forsquaregreen %>% slice(10), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0, col = "darkgreen",  lty= 3)+
geom_rect(data = forsquaregreen %>% slice(3), aes(xmin = k2min, xmax = k2max, ymin = lambda0min, ymax = lambda0max, fill = "Green"), alpha = 0, col = "darkgreen",  lty= 2)+
# forsquaregreen %>% slice(-5, -8)+
scale_fill_manual(values = c("red", "chocolate", "darkgreen"))+
# geom_rect(aes(xmin = 3.6, xmax = 3.8, ymin = 0.4, ymax = 0.44, fill = "Green"); )+
geom_segment(aes(x = 3.6, xend = 3.6, y= 0.44, yend = 0.4 ), col = "darkgreen")+
geom_segment(aes(x = 3.8 , xend = 3.8 , y= 0.44, yend = 0.4 ), col = "darkgreen")+
geom_segment(aes(x = 3.6, xend = 3.8 , y= 0.44, yend = 0.44 ), col = "darkgreen")+
geom_segment(aes(x = 3.6, xend = 3.8, y= 0.4, yend = 0.4 ), col = "darkgreen")+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0), col = "darkgreen", alpha = 0.2); plot6
param %>%
left_join( param %>% filter(!!parse_expr(pointsabove)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
left_join( param %>% filter(!!parse_expr(pointsbelow)) %>% mutate(nop = T)) %>%
filter(is.na(nop)) %>%
select(-nop) %>%
filter(!( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44)) %>%
sample_n(20) -> news
plot7 <- param20 %>%
ggplot()+
# geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)), aes(k2, lambda0,  col = "Extrap. Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Extrap. Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Extrap. Accepted"))+
geom_point(data = param20, aes(x = k2, y = lambda0, col = "From RxODE"))+
scale_color_manual(values = c("red", "darkgreen", "chocolate", "black"))+
labs(col = "   VPs")+
theme_bw() ; plot7
plot8 <- param20 %>%
ggplot()+
geom_point(aes(x = k2, y = lambda0, col = label))+
geom_point(data = param %>% filter(!!parse_expr(pointsabove)) , aes(k2, lambda0,  col = "Above"))+
geom_point(data = param %>% filter(!!parse_expr(pointsbelow)), aes(k2, lambda0,  col = "Below"))+
geom_point(data = param %>% filter( k2>= 3.6 & k2<=3.8 & lambda0>= 0.4 &lambda0<=0.44), aes(k2, lambda0, col = "Accepted"))+
# geom_point(data = param20, aes(x = k2, y = lambda0))+
scale_color_manual(values = c("red", "darkgreen", "chocolate"))+
labs(col = "VPs")+
theme_bw()+
geom_point(data = news, aes(k2, lambda0))
plot_grid(plot1, plot2, plot3, plot4, plot5, plot6,plot7, plot8, nrow = 2, labels = LETTERS[1:8])
